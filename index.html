<script>
  let submitted = false; // flag to prevent double submit

  function handleSubmit(event) {
    event.preventDefault();

    if (submitted) return; // block if already submitted
    submitted = true;

    const form = document.getElementById('addrForm');
    const ok = document.getElementById('ok');
    const err = document.getElementById('err');
    const formData = new FormData(form);
    const submitBtn = document.getElementById('submitBtn');

    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    fetch(form.action, {
      method: 'POST',
      body: formData,
      mode: 'no-cors'
    })
    .then(() => {
      ok.style.display = 'block';
      err.style.display = 'none';
      form.reset();

      setTimeout(() => {
        window.location.href = 'https://ajhellen.github.io/Save-The-Date/thanks.html';
      }, 1500);
    })
    .catch(() => {
      submitted = false; // allow retry if error
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Address';
      ok.style.display = 'none';
      err.style.display = 'block';
    });
  }

  document.getElementById('addrForm').addEventListener('submit', handleSubmit);
</script>
